
# Server-browser isomorphic testing demo repo

This repo contains a prototype implementation of isomorphic testing for
JS libraries. 

## Goals

- automatic testing both server-side and browser-side with correct
  handling of status code so that CI can correctly break when tests
  do not pass 
- TypeScript support
- ESM support
- support for running a partial set of tests depending on whether we're
  browser-side or server-side
- keep dependency count low (~300 for the time being) 

## How it works

- The `tsc` TypeScript compiler is used to generate ESM sources for both
  the library itself and its tests, in two separate and independent build
  steps.
- The `fix-esm-import-paths.cjs` script is used to fix the `import` / `export`
  paths generated by `tsc`, which are not ES-compliant as they lack the `.js`
  extension
- `webpack` is used to create a browser-side ESM bundle of the subset of tests 
  that are suitable for browser-side execution
  (see `test/browser/webpack.config.cjs`)
- `puppeteer` is used to programmatically launch the browser, run the test
  suite and report the number of failures back to the main process so that it 
  may terminate with a non-0 exit code for CI purposes 
  (see `test/browser/main.ts`)
- `package.json` is used to concatenate the execution of server-side and 
  browser-side tests in a single `npm test` command.
